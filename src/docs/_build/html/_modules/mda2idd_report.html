

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mda2idd_report &mdash; mda2idd_report 2013-02-14 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2013-02-14',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="mda2idd_report 2013-02-14 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">mda2idd_report 2013-02-14 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for mda2idd_report</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Generate ASCII text files from MDA files for APS station 2-ID-D</span>

<span class="sd">Objectives</span>
<span class="sd">------------</span>

<span class="sd">* Replaces *yviewer*, ``asciiRpt.py`` and ``mdaRpt.py``</span>
<span class="sd">* Creates a GUI similar to that of ``asciiRpt.py`` (aka *yviewer*)</span>

<span class="sd">Different than the output from *mdaAscii*, this module</span>
<span class="sd">converts 1-D and 2-D scans stored in MDA files [#]_ into the</span>
<span class="sd">text file format produced by ``yca scanSee_report`` (a</span>
<span class="sd">Yorick-based support).</span>

<span class="sd">.. [#] MDA format specification: http://www.aps.anl.gov/bcda/synApps/sscan/saveData_fileFormat.txt</span>


<span class="sd">Main Methods</span>
<span class="sd">------------</span>

<span class="sd">* :func:`report()`:</span>
<span class="sd">  converts MDA file to 1 or more ASCII text files, based on the rank</span>

<span class="sd">* :func:`report_list()`:</span>
<span class="sd">  process a list of MDA files</span>

<span class="sd">* :func:`summaryMda()`:</span>
<span class="sd">  text summary of a single MDA file (name, rank, datetime, ...)</span>
<span class="sd">    </span>
<span class="sd">Internal (but interesting) Methods</span>
<span class="sd">----------------------------------</span>

<span class="sd">* :func:`report_1d()`:</span>
<span class="sd">  report 1-D MDA scan data in the format for APS station 2-ID-D</span>
<span class="sd">  (called by :func:`report()`)</span>

<span class="sd">* :func:`report_2d()`:</span>
<span class="sd">  report 2-D MDA scan data in the format for APS station 2-ID-D</span>
<span class="sd">  (called by :func:`report()`)</span>

<span class="sd">* :func:`columnsToText()`:</span>
<span class="sd">  convert a list of column lists into rows of text</span>

<span class="sd">Dependencies</span>
<span class="sd">------------</span>

<span class="sd">operating system</span>
<span class="sd">^^^^^^^^^^^^^^^^^^^</span>

<span class="sd">None.  This software was developed on a Windows 7 system and tested on </span>
<span class="sd">various Linux distributions (Ubuntu, mint, and RHEL Linux) and on MacOSX.  </span>
<span class="sd">It was also tested on solaris but the performance was too poor on that </span>
<span class="sd">specific system to advocate its continued use.</span>

<span class="sd">MDA file support</span>
<span class="sd">^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="sd">This code requires the *mda* file format support library from APS synApps.  </span>
<span class="sd">Principally, two files support files are needed.</span>
<span class="sd">Download them and place them in the same directory with this project.</span>

<span class="sd">* https://subversion.xray.aps.anl.gov/synApps/utils/trunk/mdaPythonUtils/mda.py</span>
<span class="sd">* https://subversion.xray.aps.anl.gov/synApps/utils/trunk/mdaPythonUtils/f_xdrlib.py</span>

<span class="sd">In the same directory, there are also a pair of files (*setup.cfg* &amp; *setup.py*) </span>
<span class="sd">that can be used to install the mda support into the python site-packages directory.</span>
<span class="sd">Install them with these commands:</span>

<span class="sd">&gt;&gt;&gt; svn co https://subversion.xray.aps.anl.gov/synApps/utils/trunk/mdaPythonUtils mdaPythonUtils</span>
<span class="sd">&gt;&gt;&gt; cd mdaPythonUtils</span>
<span class="sd">&gt;&gt;&gt; python setup.py install</span>

<span class="sd">---------------------------------</span>

<span class="sd">Source Code Documentation</span>
<span class="sd">-------------------------</span>

<span class="sd">&#39;&#39;&#39;</span>


<span class="c">########### SVN repository information ###################</span>
<span class="c"># $Date: 2013-03-04 10:32:28 -0600 (Mon, 04 Mar 2013) $</span>
<span class="c"># $Author: jemian $</span>
<span class="c"># $Revision: 1240 $</span>
<span class="c"># $URL: https://subversion.xray.aps.anl.gov/bcdaext/mda2idd_report/src/mda2idd_report.py $</span>
<span class="c"># $Id: mda2idd_report.py 1240 2013-03-04 16:32:28Z jemian $</span>
<span class="c">########### SVN repository information ###################</span>


<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">optparse</span>
<span class="kn">import</span> <span class="nn">mda</span>


<span class="n">ROW_INDEX_FORMAT</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%5d</span><span class="s">&#39;</span>

<span class="n">__description__</span> <span class="o">=</span> <span class="s">&quot;Generate ASCII text files from MDA files for APS station 2-ID-D&quot;</span>
<span class="n">__svnid__</span> <span class="o">=</span> <span class="s">&quot;$Id: mda2idd_report.py 1240 2013-03-04 16:32:28Z jemian $&quot;</span>


<div class="viewcode-block" id="summaryMda"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.summaryMda">[docs]</a><span class="k">def</span> <span class="nf">summaryMda</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    text summary of a single MDA file (name, rank, datetime, ...)</span>
<span class="sd">    </span>
<span class="sd">    Developed for the GUI to give the user a preview of the file</span>
<span class="sd">    before saving its data as ASCII to a text file.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">readMDA</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;could not read: &#39;</span> <span class="o">+</span> <span class="n">mdaFileName</span>
    
    <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;MDA version = </span><span class="si">%.1f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;version&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;Filename = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;filename&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;rank = </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;rank&#39;</span><span class="p">])</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;1-D Scan # = </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;scan_number&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;1-D scan timeStamp= </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="p">)</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;dimensions = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;dimensions&#39;</span><span class="p">]))</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;acquired_dimensions = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;acquired_dimensions&#39;</span><span class="p">]))</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;EPICS PVs&#39;</span><span class="p">)</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;---------&#39;</span><span class="p">)</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;ourKeys&#39;</span><span class="p">]:</span>
            <span class="n">desc</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s">&quot; [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="n">desc</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s">&quot; (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">unit</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s">&quot; </span><span class="si">%s</span><span class="s"> =&quot;</span> <span class="o">%</span> <span class="n">k</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s">&quot; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="n">txt</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">dimNum</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">dimNum</span><span class="p">:</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">-D Scan Info&#39;</span> <span class="o">%</span> <span class="n">dimNum</span><span class="p">)</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;-------------&#39;</span><span class="p">)</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dimNum</span><span class="p">]</span>
            <span class="n">parts_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;Positioners&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
                <span class="s">&#39;Detectors&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                <span class="s">&#39;Triggers&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">partname</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">indent</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span>
                    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">partname</span><span class="p">)</span>
                    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">indent</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;~&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">partname</span><span class="p">)))</span>
                    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">part</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">partname</span> <span class="o">==</span> <span class="s">&#39;Triggers&#39;</span><span class="p">:</span>
                            <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">command</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:  </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">fieldName</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">txt</span> <span class="o">+=</span> <span class="s">&quot; (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">unit</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">txt</span> <span class="o">+=</span> <span class="s">&quot;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="o">.</span><span class="n">desc</span>
                        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">txt</span> <span class="p">)</span>

    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ReadMdaException"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.ReadMdaException">[docs]</a><span class="k">class</span> <span class="nc">ReadMdaException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MDA files are all version 1.3 (+/- 0.01)&#39;&#39;&#39;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="RankException"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.RankException">[docs]</a><span class="k">class</span> <span class="nc">RankException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;this report can only handle ranks 1 and 2&#39;&#39;&#39;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="report"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.report">[docs]</a><span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">,</span> <span class="n">allowException</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    converts MDA file to 1 or more ASCII text files, based on the rank</span>
<span class="sd">    </span>
<span class="sd">    :param str mdaFileName: includes absolute or relative path to MDA file</span>
<span class="sd">    :returns dict: {mdaFileName: [asciiFileName]}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">converted</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">converted</span>

    <span class="n">asciiPath</span> <span class="o">=</span> <span class="n">getAsciiPath</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">readMDA</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;could not read data from MDA file: &quot;</span> <span class="o">+</span> <span class="n">mdaFileName</span>
        <span class="k">if</span> <span class="n">allowException</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ReadMdaException</span><span class="p">,</span> <span class="n">msg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">msg</span>
        <span class="k">return</span> <span class="n">converted</span>
        
    <span class="n">rank</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;rank&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rank</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;acquired_dimensions&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">rank</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">report_1d</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">report_2d</span><span class="p">}[</span><span class="n">rank</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">method</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">writeOutput</span><span class="p">(</span><span class="n">asciiPath</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mdaFileName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">converted</span><span class="p">:</span>
                    <span class="n">converted</span><span class="p">[</span><span class="n">mdaFileName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">converted</span><span class="p">[</span><span class="n">mdaFileName</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">asciiPath</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">-D data: not handled by this code&#39;</span> <span class="o">%</span> <span class="n">rank</span>
        <span class="k">if</span> <span class="n">allowException</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RankException</span><span class="p">,</span> <span class="n">msg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">msg</span>
                
    <span class="k">return</span> <span class="n">converted</span>

</div>
<div class="viewcode-block" id="report_1d"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.report_1d">[docs]</a><span class="k">def</span> <span class="nf">report_1d</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    report 1-D MDA scan data in this format:</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: guess</span>
<span class="sd">       :linenos:</span>

<span class="sd">       ; </span>
<span class="sd">       ; ========================================================</span>
<span class="sd">       ; Filename: /home/2-iddf/data12c3/Alix_NWU/mda/2iddf_0001.mda</span>
<span class="sd">       ; 1D Scanno # =        1</span>
<span class="sd">       ; title= (Scan # 1)</span>
<span class="sd">       ; xtitle= PI_sample1_X(micron)</span>
<span class="sd">       ; ytitle= </span>
<span class="sd">       ; timeStamp= OCT 30, 2012 12:03:41</span>
<span class="sd">       ; comment= </span>
<span class="sd">       ; </span>
<span class="sd">       ; </span>
<span class="sd">       ; DIS:             P1                 D1                 D2                 ...</span>
<span class="sd">       ; Name:            2iddf:m38.VAL      S:SRcurrentAI      2idd:scaler1_cts1. ...</span>
<span class="sd">       ; Desc:            PI_sample1_X       SR Current                            ...</span>
<span class="sd">       ; Unit:            micron             mA                                    ...</span>
<span class="sd">         1               1197.47            122.374            169.800             ...</span>
<span class="sd">         2               1198.97            122.347            169.400             ...</span>
<span class="sd">         3               1200.47            122.318            171.000             ...</span>
<span class="sd">         4               1201.97            122.289            173.600             ...</span>
<span class="sd">         5               1203.47            122.777            169.000             ...</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="p">]</span>
    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;=&#39;</span><span class="o">*</span><span class="mi">55</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;; Filename: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;filename&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;; 1D Scanno # = </span><span class="si">%8d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;scan_number&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;; title= (Scan # </span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;scan_number&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;; xtitle= </span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;; ytitle= &#39;</span> <span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;; timeStamp= </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;; comment= &#39;</span> <span class="p">)</span>
    
    <span class="c"># build the table, one column at a time, then use zip to transpose the table to rows</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">[</span><span class="s">&#39;; </span><span class="si">%-5s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;DIS&#39;</span><span class="p">,</span> <span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="s">&#39;Desc&#39;</span><span class="p">,</span> <span class="s">&#39;Unit&#39;</span><span class="p">)]</span>
      <span class="o">+</span> <span class="p">[</span><span class="n">ROW_INDEX_FORMAT</span> <span class="o">%</span> <span class="p">(</span><span class="n">rownum</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">rownum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">curr_pt</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">):</span>  <span class="c"># positioners, then detectors</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">part</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">fieldName</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span>
              <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
            <span class="p">)</span>
    
    <span class="c"># return value is a dictionary:</span>
    <span class="c">#   key is file name, value is file contents</span>
    <span class="k">return</span> <span class="p">{</span> <span class="n">getAsciiFileName</span><span class="p">(</span><span class="n">data</span><span class="p">):</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">columnsToText</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>  <span class="p">}</span>

</div>
<div class="viewcode-block" id="report_2d"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.report_2d">[docs]</a><span class="k">def</span> <span class="nf">report_2d</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    report 2-D MDA scan data in this format, one file for each  detector:</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: guess</span>
<span class="sd">       :linenos:</span>

<span class="sd">       ; FILE:  /home/2-iddf/data12c3/Alix_NWU/mda/2iddf_0012.mda</span>
<span class="sd">       ; Title:  Image#16 (2iddf:mca1.R9) - D01</span>
<span class="sd">       ; Scan # =       12 ,  Detector # =       16 ,   col=       51 ,   row=       51</span>
<span class="sd">       ;            Yvalue:        -1712.03        -1711.53        -1711.03        -1710.53        ...</span>
<span class="sd">       ;             Yindex               1               2               3               4        ...</span>
<span class="sd">       ; Xindex,    Xvalue,        Image(I,J) Array                                                ...</span>
<span class="sd">         1          1289.55         0.00000         0.00000         0.00000         0.00000        ...</span>
<span class="sd">         2          1290.05         0.00000         0.00000         0.00000         0.00000        ...</span>
<span class="sd">         3          1290.55         0.00000         0.00000         0.00000         0.00000        ...</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">scanNum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;scan_number&#39;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">detNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">nd</span><span class="p">):</span>
        <span class="n">asciiFile</span> <span class="o">=</span> <span class="n">getAsciiFileName</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">detNum</span><span class="o">=</span><span class="n">detNum</span><span class="p">)</span>

        <span class="n">num_cols</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">curr_pt</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">curr_pt</span>

        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;; FILE:  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;filename&#39;</span><span class="p">],</span> <span class="p">]</span>
        <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="s">&#39;; Title:  Image#</span><span class="si">%d</span><span class="s"> (</span><span class="si">%s</span><span class="s">) - </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">detNum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">detNum</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">detNum</span><span class="p">]</span><span class="o">.</span><span class="n">fieldName</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;; Scan # = </span><span class="si">%8d</span><span class="s"> ,  Detector # = </span><span class="si">%8d</span><span class="s"> ,  col= </span><span class="si">%8d</span><span class="s"> ,  row= </span><span class="si">%8d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scanNum</span><span class="p">,</span> <span class="n">detNum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">num_rows</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># build the table, one column at a time, then use zip to transpose the table to rows</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="s">&#39;; Xindex,&#39;</span><span class="p">]</span>
          <span class="o">+</span> <span class="p">[</span><span class="n">ROW_INDEX_FORMAT</span> <span class="o">%</span> <span class="p">(</span><span class="n">rownum</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">rownum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)]</span>
          <span class="c"># TODO: right-pad when curr_pt &lt; npts !</span>
        <span class="p">)</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="s">&#39;Yvalue:&#39;</span><span class="p">,</span> <span class="s">&#39;Yindex&#39;</span><span class="p">,</span> <span class="s">&#39;Xvalue,&#39;</span><span class="p">]</span>
          <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
          <span class="c"># TODO: right-pad when curr_pt &lt; npts !</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">colNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cols</span><span class="p">):</span>
            <span class="n">img_title</span> <span class="o">=</span> <span class="p">{</span><span class="bp">False</span><span class="p">:</span> <span class="s">&#39;Image(I,J) Array&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">}[</span><span class="n">colNum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">colNum</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">colNum</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">img_title</span><span class="p">]</span>
              <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">detNum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">colNum</span><span class="p">]]</span>
              <span class="c"># TODO: right-pad when curr_pt &lt; npts !</span>
            <span class="p">)</span>

        <span class="n">output</span><span class="p">[</span><span class="n">asciiFile</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">columnsToText</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> 
    
    <span class="c"># return value is a dictionary:</span>
    <span class="c">#   keys are file names, values are file contents</span>
    <span class="k">return</span> <span class="n">output</span>

</div>
<div class="viewcode-block" id="columnsToText"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.columnsToText">[docs]</a><span class="k">def</span> <span class="nf">columnsToText</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    convert a list of column lists into rows of text</span>
<span class="sd">    </span>
<span class="sd">    column widths will be chosen from the maximum character width of each column</span>
<span class="sd">    </span>
<span class="sd">    :param [[str]] columns: list of column lists (all same length)</span>
<span class="sd">    :returns str: text block, with line separators</span>
<span class="sd">    </span>
<span class="sd">    Example::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; columns = [ [&#39;1A&#39;, &#39;2A&#39;], [&#39;1B is long&#39;, &#39;2B&#39;], [&#39;1C&#39;, &#39;2C&#39;] ]</span>
<span class="sd">        &gt;&gt;&gt; print columnsToText( columns )</span>
<span class="sd">        1A  1B is long  1C</span>
<span class="sd">        2A  2B          2C</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># get the largest width for each column</span>
    <span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
    <span class="c"># left-align each column</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s&#39;</span> <span class="o">%</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">widths</span><span class="p">])</span>
    <span class="c"># rows = zip(*columns) : matrix transpose</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmt</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">columns</span><span class="p">)]</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="writeOutput"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.writeOutput">[docs]</a><span class="k">def</span> <span class="nf">writeOutput</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    write the output text buffer to the file</span>
<span class="sd">    </span>
<span class="sd">    :param str path: absolute or relative path to directory </span>
<span class="sd">                     where file should be written</span>
<span class="sd">    :param str filename: name of file to be written, existing file</span>
<span class="sd">                         will be overwritten without warning</span>
<span class="sd">    :param str output: text buffer to write to file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="getAsciiFileName"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.getAsciiFileName">[docs]</a><span class="k">def</span> <span class="nf">getAsciiFileName</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">detNum</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    return the proper text file name, based on the file name stored in the MDA data structure</span>
<span class="sd">    </span>
<span class="sd">    :param obj data: MDA data structure returned by mda.readMDA()</span>
<span class="sd">    :param int detNum: (2-D only)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mdaFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;filename&#39;</span><span class="p">])</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">extsep</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;rank&#39;</span><span class="p">]</span> 
    <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">asciiFileName</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">root</span><span class="p">,</span> <span class="s">&#39;1d&#39;</span><span class="p">,</span> <span class="s">&#39;txt&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">detector_channel</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">detNum</span><span class="p">]</span><span class="o">.</span><span class="n">fieldName</span>
        <span class="n">asciiFileName</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">root</span><span class="p">,</span> <span class="s">&#39;im&#39;</span><span class="o">+</span><span class="n">detector_channel</span><span class="p">,</span> <span class="s">&#39;txt&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">asciiFileName</span>

</div>
<div class="viewcode-block" id="getAsciiPath"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.getAsciiPath">[docs]</a><span class="k">def</span> <span class="nf">getAsciiPath</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    given the path to the MDA file, return the related ASCII file path</span>
<span class="sd">    </span>
<span class="sd">    Create the path to the ASCII directory if it does not exist.</span>
<span class="sd">    If we cannot create the ASCII dir path, return the MDA file path instead.</span>
<span class="sd">    </span>
<span class="sd">    The default expectation is that the files are stored </span>
<span class="sd">    in this type of directory structure::</span>
<span class="sd">    </span>
<span class="sd">      some/path/to/data/</span>
<span class="sd">        ./MDA/</span>
<span class="sd">           scan_0001.mda</span>
<span class="sd">        ./ASCII/</span>
<span class="sd">           scan_0001.1d.txt</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mdaPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">mdaFileName</span><span class="p">)</span>
    <span class="n">asciiPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mdaPath</span><span class="p">,</span> <span class="s">&#39;..&#39;</span><span class="p">,</span> <span class="s">&#39;ASCII&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">asciiPath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">asciiPath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">asciiPath</span><span class="p">):</span>
            <span class="c">#raise OSError, &quot;could not create ASCII subdirectory, does not exist either&quot;</span>
            <span class="n">asciiPath</span> <span class="o">=</span> <span class="n">mdaPath</span>
    <span class="k">return</span> <span class="n">asciiPath</span>

</div>
<div class="viewcode-block" id="developer_test"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.developer_test">[docs]</a><span class="k">def</span> <span class="nf">developer_test</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;only for use in code development and testing&#39;&#39;&#39;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;..&#39;</span><span class="p">,</span> <span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="s">&#39;mda&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;*.mda&#39;</span><span class="p">):</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="n">report</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="c"># report what was converted to stdout</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">converted</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="s">&#39;--&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="report_list"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.report_list">[docs]</a><span class="k">def</span> <span class="nf">report_list</span><span class="p">(</span><span class="n">mdaFileList</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;process a list of MDA files&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">mdaFile</span> <span class="ow">in</span> <span class="n">mdaFileList</span><span class="p">:</span>
        <span class="n">report</span><span class="p">(</span><span class="n">mdaFile</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../mda2idd_report.html#mda2idd_report.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;handles command-line input&#39;&#39;&#39;</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="s">&#39;usage: %prog [options] mdaFile [mdaFile ...]&#39;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">__description__</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">__svnid__</span><span class="p">)</span>
    <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">report_list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c">#developer_test()</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">mda2idd_report 2013-02-14 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Pete Jemian.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>